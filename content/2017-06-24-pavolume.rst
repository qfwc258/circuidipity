===============================
Volume control and notification
===============================

:date: 2017-06-24 08:47:00
:slug: pavolume
:tags: homebin, shell, programming, linux

`PROJECT: $HOME slash bin .: <http://www.circuidipity.com/homebin.html>`_ My original intent was to manage sound on `Stretchbook <http://www.circuidipity.com/jessiebook-to-stretchbook.html>`_ by binding the commands to the multimedia keys in `~/.xbindkeysrc. <http://www.circuidipity.com/xbindkeysrc.html>`_ Instead ``xbindkeys`` calls a standalone script I created to control PulseAudio volume (and thus useful beyond just ``xbindkeys``).

Let's go!
=========

Script requirements: ``pactl``, ``pamixer``, and ``volnoti``.

0. Pactl
--------

``Pactl`` controls a PulseAudio sound server and is included in ``pulseaudio-utils`` ...

.. code-block:: bash

    $ sudo apt install pulseaudio-utils

1. Pamixer
----------

`Pamixer <https://github.com/cdemoulins/pamixer>`_ is a PulseAudio console mixer. Compile dependencies ...

.. code-block:: bash

    $ sudo apt install build-essential libpulse-dev libboost-program-options1.62.0:amd64 libboost-program-options-dev

Download source and compile ...

.. code-block:: bash

    $ git clone https://cdemoulins@github.com/cdemoulins/pamixer.git
    $ cd pamixer
    $ make

No ``make install``. Place the resulting ``pamixer`` in PATH (I use ``~/bin``).

2. Volnoti
----------

`Volnoti <https://github.com/davidbrazdil/volnoti>`_ is a lightweight volume notification. Compile dependencies ...

.. code-block:: bash

    $ sudo apt install libdbus-glib-1-dev libgtk2.0-dev libgdk-pixbuf2.0-dev autoconf automake

Download ...

.. code-block:: bash

    $ git clone git://github.com/davidbrazdil/volnoti.git
    $ cd volnoti
    $ ./prepare.sh
    $ ./configure --prefix=/usr

Apply this fix [1]_ to the source ...

.. code-block:: bash

    $ cd src
    $ rm value-client-stub.h && make value-client-stub.h
    $ rm value-daemon-stub.h && make value-daemon-stub.h
    $ cd ..

Compile source (and I use `checkinstall <https://packages.debian.org/stretch/checkinstall>`_ to make a ``deb`` package and install) ...

.. code-block:: bash

    $ make
    $ sudo checkinstall make install

Start ``volnoti`` daemon ...

.. code-block:: bash

    $ volnoti

Configure daemon to auto-start by adding it to `~/.xinitrc <http://www.circuidipity.com/xinitrc.html>`_ ... 

.. code-block:: bash

    volnoti -t 2 &

3. Script paVolume
------------------

I tie all the pieces together with my paVolume shell script and create keycodes to increase/decrease/mute volume in ``~/.xbindkeysrc`` ...

.. code-block:: bash

    "paVolume -m"
    F8
    "paVolume -m"
    XF86AudioMute
    "paVolume -d"
    F9
    "paVolume -d"
    XF86AudioLowerVolume
    "paVolume -u"
    F10
    "paVolume -u"
    XF86AudioRaiseVolume

Sources: `homebin/paVolume <https://github.com/vonbrownie/homebin/blob/master/paVolume>`_ and `dotfiles/.xbindkeysrc.chromebook <https://github.com/vonbrownie/dotfiles/blob/master/.xbindkeysrc.chromebook>`_

Happy hacking!

Notes
`````

.. [1] Ubuntu forums: `Error when using make "client.c:108:5: error: too many arguments to function" <http://ubuntuforums.org/showthread.php?t=2215264&s=7aa2dfa8b89411472598e737c38f1475&p=12978792#post12978792>`_
