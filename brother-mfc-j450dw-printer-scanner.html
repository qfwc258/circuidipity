<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
        <title>Circuidipity | Brother MFC-J450DW All-In-One Printer/Scanner</title>
        <meta http-equiv="content-type" content="text/html"; charset="utf-8" />
        <meta http-equiv="pragma" content="no-cache" />
        <meta name="author" content="Daniel Wayne Armstrong" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/css/main.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/css/pygment.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/css/font.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/images/icons/font-awesome/css/font-awesome.min.css">
        <link rel="icon" href="http://www.circuidipity.com/theme/images/favicon.ico" type="image/x-icon" />
</head>

<body>
        <!-- content -->

<!-- breadcrumb trail -->
<div id="breadcrumb">
    <p><a href="/"><i class="fa fa-rocket"></i> Howdy!</a> &nbsp;<i class="fa fa-arrow-right"></i>&nbsp;
    <a href="archives.html">Archives</a> &nbsp;<i class="fa fa-arrow-right"></i>&nbsp;
    Wednesday 04 March 2015</p>
</div>

<!-- article -->
<h1>Brother MFC-J450DW All-In-One Printer/Scanner</h1>
<div id="article">
    <p>Connect a <strong>Brother MFC-J450DW</strong> to a repurposed netbook as server running Ubuntu 14.04 LTS and configure as printer/scanner for a home network.</p>
<div class="section" id="let-s-go">
<h2>Let's go!</h2>
</div>
<div class="section" id="cups-sane">
<h2>0. CUPS + SANE</h2>
<p>Attach the Brother device to server:</p>
<div class="highlight"><pre><span class="nv">$ </span>dmesg -t
<span class="o">[</span>...snip...<span class="o">]</span>
usb 5-1: new high-speed USB device number <span class="m">4</span> using ehci-pci
usb 5-1: New USB device found, <span class="nv">idVendor</span><span class="o">=</span>04f9, <span class="nv">idProduct</span><span class="o">=</span>02fa
usb 5-1: New USB device strings: <span class="nv">Mfr</span><span class="o">=</span>1, <span class="nv">Product</span><span class="o">=</span>2, <span class="nv">SerialNumber</span><span class="o">=</span>3
usb 5-1: Product: MFC-J450DW
usb 5-1: Manufacturer: Brother
usb 5-1: SerialNumber: BROH4F240529
usblp 5-1:1.0: usblp0: USB Bidirectional printer dev <span class="m">4</span> <span class="k">if</span> <span class="m">0</span> alt <span class="m">0</span> proto <span class="m">2</span> vid 0x04F9 pid 0x02FA
usbcore: registered new interface driver usblp
</pre></div>
<p>Install CUPS (printer) and SANE (scanner) packages and grant (example) <tt class="docutils literal">username</tt> admin privileges:</p>
<div class="highlight"><pre><span class="nv">$ </span>sudo apt-get install cups cups-bsd sane-utils libsane-extras
<span class="nv">$ </span>sudo adduser username lp
<span class="nv">$ </span>sudo adduser username lpadmin
<span class="nv">$ </span>sudo adduser username scanner
</pre></div>
</div>
<div class="section" id="brother-drivers">
<h2>1. Brother drivers</h2>
<p>Download the <strong>Driver Install Tool</strong> from <a class="reference external" href="http://support.brother.com/g/b/downloadtop.aspx?c=us&amp;lang=en&amp;prod=mfcj450dw_us">Brother MFC-J450DW Downloads</a> and install drivers:</p>
<div class="highlight"><pre><span class="nv">$ </span>gunzip linux-brprinter-installer-*.gz
<span class="nv">$ </span>sudo su
<span class="c"># bash linux-brprinter-installer-2.0.0-1</span>
Input model name -&gt;MFC-J450DW

You are going to install following packages.
    mfcj450dwlpr-3.0.0-1.i386.deb
    mfcj450dwcupswrapper-3.0.0-1.i386.deb
    brscan4-0.4.2-1.i386.deb
    brscan-skey-0.2.4-1.i386.deb
OK? <span class="o">[</span>y/N<span class="o">]</span> -&gt;y
<span class="o">[</span>...snip...<span class="o">]</span>
Will you specify the Device URI? <span class="o">[</span>Y/n<span class="o">]</span> -&gt;Y

0: ipps
1: https
2: http
3: ipp14
4: lpd
5: ipp
6: socket
7: usb://Brother/MFC-J450DW?serial<span class="o">=</span>BROH4F240529
8: smb
<span class="m">9</span> <span class="o">(</span>I<span class="o">)</span>: Specify IP address.
<span class="m">10</span> <span class="o">(</span>A<span class="o">)</span>: Auto. <span class="o">(</span>usb://Brother/MFC-J450DW?serial<span class="o">=</span>BROH4F240529<span class="o">)</span>

<span class="k">select</span> the number of destination Device URI. -&gt;10

lpadmin -p MFCJ450DW -v usb://Brother/MFC-J450DW?serial<span class="o">=</span>BROH4F240529 -E
Test Print? <span class="o">[</span>y/N<span class="o">]</span> -&gt;y


lpadmin -p MFCJ450DW -v usb://Brother/MFC-J450DW?serial<span class="o">=</span>BROH4F240529 -E
Test Print? <span class="o">[</span>y/N<span class="o">]</span> -&gt;y

<span class="nb">wait </span>5s.
lpr -P MFCJ450DW /usr/share/cups/data/testprint
You are going to install following packages.
    brscan4-0.4.2-1.i386.deb
<span class="o">[</span>...snip...<span class="o">]</span>
Do you agree? <span class="o">[</span>Y/n<span class="o">]</span> -&gt;Y

You are going to install following packages.
    brscan-skey-0.2.4-1.i386.deb
<span class="o">[</span>...snip...<span class="o">]</span>
Do you agree? <span class="o">[</span>Y/n<span class="o">]</span> -&gt;Y
<span class="o">[</span>...snip...<span class="o">]</span>
Hit Enter/Return key.
</pre></div>
<p><strong>Problem:</strong> Scanner stuck in low-res mode using Linux scanner clients. <strong>Simple-scan</strong> would not scan above 300dpi and would throw constant error messages. <strong>Xsane</strong> would not scan at all and throw <tt class="docutils literal">out of memory</tt> errors. Turns out the Brother installer downloaded and installed an outdated, buggy scanner driver - <tt class="docutils literal"><span class="pre">brscan4-0.4.2-1.i386.deb</span></tt> - when a newer <tt class="docutils literal"><span class="pre">brscan4-0.4.3-*.i386.deb</span></tt> driver exists.</p>
<p><strong>Fix:</strong> Remove the buggy driver and manually install the updated package:</p>
<div class="highlight"><pre><span class="nv">$ </span>sudo service saned stop
<span class="nv">$ </span>sudo dpkg -P brscan4
<span class="nv">$ </span>sudo dpkg -i brscan4-0.4.3-0.i386.deb
<span class="nv">$ </span>sudo service saned start
</pre></div>
<p>Source: <a class="reference external" href="http://technik.blogs.nde.ag/2013/12/06/brother-dcp-j925dw-problems-when-scanning-via-sane/">Problems when scanning via SANE</a></p>
</div>
<div class="section" id="printer-config">
<h2>2. Printer config</h2>
<p>Modify <tt class="docutils literal">/etc/cups/cupsd.conf</tt> to listen for connections from any device on the home network. Example for home server at ip address <tt class="docutils literal">192.168.1.88</tt>:</p>
<div class="highlight"><pre><span class="c"># Only listen for connections from the local machine.</span>
<span class="c">#Listen localhost:631</span>
Listen *:631

<span class="c"># Show shared printers on the local network.</span>
Browsing On
BrowseLocalProtocols dnssd

<span class="c"># Web interface setting...</span>
WebInterface Yes

<span class="c"># Restrict access to the server...</span>
&lt;Location /&gt;
  Order allow,deny
  Allow 192.168.1.*
&lt;/Location&gt;

<span class="c"># Restrict access to the admin pages...</span>
&lt;Location /admin&gt;
  Order allow,deny
  Allow 192.168.1.*
&lt;/Location&gt;
</pre></div>
<p>Restart CUPS:</p>
<div class="highlight"><pre><span class="nv">$ </span>sudo service cups restart
</pre></div>
<p>Admin functions available at <tt class="docutils literal"><span class="pre">http://192.168.1.88:631/admin</span></tt>.</p>
</div>
<div class="section" id="scanner-config">
<h2>3. Scanner config</h2>
<div class="section" id="on-the-server">
<h3>On the server</h3>
<p>Detect attached device using <tt class="docutils literal"><span class="pre">sane-find-scanner</span></tt> and <tt class="docutils literal">scanimage</tt> (I find that if one fails discovery the other usually works):</p>
<div class="highlight"><pre><span class="nv">$ </span>sane-find-scanner
found USB scanner <span class="o">(</span><span class="nv">vendor</span><span class="o">=</span>0x04f9 <span class="o">[</span>Brother<span class="o">]</span>, <span class="nv">product</span><span class="o">=</span>0x02fa <span class="o">[</span>MFC-J450DW<span class="o">])</span> at libusb:005:00
<span class="nv">$ </span>scanimage -L
device <span class="sb">`</span>brother4:bus1<span class="p">;</span>dev1<span class="err">&#39;</span> is a Brother MFC-J450DW USB scanner
</pre></div>
<p>Modify <tt class="docutils literal">/etc/default/saned</tt> to run SANE as server:</p>
<div class="highlight"><pre><span class="nv">RUN</span><span class="o">=</span>yes
</pre></div>
<p>Modify <tt class="docutils literal">/etc/sane.d/saned.conf</tt> to share the scanner over the network:</p>
<div class="highlight"><pre><span class="c">## Access list</span>
192.168.1.0/24
</pre></div>
<p>Add entry for Brother scanners to <tt class="docutils literal"><span class="pre">/lib/udev/rules.d/40-libsane.rules</span></tt> at the point in file just before the bit <tt class="docutils literal"># The following rule will <span class="pre">disable...</span></tt>:</p>
<div class="highlight"><pre><span class="c"># Brother scanners</span>
ATTRS<span class="o">{</span>idVendor<span class="o">}==</span><span class="s2">&quot;04f9&quot;</span>, ENV<span class="o">{</span>libsane_matched<span class="o">}=</span><span class="s2">&quot;yes&quot;</span>

<span class="c"># The following rule will disable...</span>
</pre></div>
<p>Reboot server (simply restarting the <tt class="docutils literal">udev</tt> and <tt class="docutils literal">saned</tt> services fails to work):</p>
<div class="highlight"><pre><span class="nv">$ </span>sudo reboot
</pre></div>
<p>Run a test:</p>
<div class="highlight"><pre><span class="nv">$ </span>scanimage --format<span class="o">=</span>tiff &gt; test.tiff
</pre></div>
</div>
<div class="section" id="on-the-client">
<h3>On the client</h3>
<p>Modify <tt class="docutils literal">/etc/sane.d/net.conf</tt> to point your device towards the server ip address:</p>
<div class="highlight"><pre><span class="nv">connect_timeout</span> <span class="o">=</span> 60
<span class="c">## saned hosts</span>
192.168.1.88
</pre></div>
<p>Run a test using <tt class="docutils literal"><span class="pre">simple-scan</span></tt> included by default in Ubuntu.</p>
<p>Happy hacking!</p>
</div>
</div>

    <p class="articletags"><i class="fa fa-coffee"></i> More         &#8226; <a class="tag" href="http://www.circuidipity.com/tag-ubuntu.html">ubuntu</a>
        &#8226; <a class="tag" href="http://www.circuidipity.com/tag-linux.html">linux</a>
        &#8226; <a class="tag" href="http://www.circuidipity.com/tag-networks.html">networks</a>
</p>
</div>

<!-- Nav links to previous|next article -->
<div id="navmenu">
    <hr />
    <p class="prevpost"><i class="fa fa-arrow-left"></i> Older<br />
        <a href="http://www.circuidipity.com/run-a-raspberry-pi-2-from-external-usb-storage.html">Run a Raspberry Pi 2 from external USB storage</a></p>
    <p class="nextpost">Newer <i class="fa fa-arrow-right"></i><br />
        <a href="http://www.circuidipity.com/samsung-clp-310-printer.html">Samsung CLP-310 Printer</a></p>
</div>


        <!-- footer -->
<div id="footer">
    <img class="imgfooter" src="./theme/images/footerbar.png" />
    <p class="contentinfo">
    <span class="noWrap">
        Copyright &#169; 2015 and
        <a rel="license" class="ccLicense" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA License</a> by
        <a rel="author" class="authorID" href="/">Daniel Wayne Armstrong</a>
    </span>
    <span class="noWrap">
        <i class="fa fa-globe"></i>
        Find me at <span class="whoa">daniel at circuidipity dot com</span>
    </span>
    <br />
    Don't miss a thing... updates by
    <a href="feed.xml">RSS</a> and
    <a class="subTweat" href="https://twitter.com/circuidipity">Twitter</a>
    </p>
</div></body>
</html>