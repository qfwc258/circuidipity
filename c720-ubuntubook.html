<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
        <title>Circuidipity | Chromebook to Ubuntubook</title>
        <meta http-equiv="content-type" content="text/html"; charset="utf-8" />
        <meta http-equiv="pragma" content="no-cache" />
        <meta name="author" content="Daniel Wayne Armstrong" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/css/main.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/css/pygment.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/css/font.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/images/icons/font-awesome/css/font-awesome.min.css">
        <link rel="icon" href="http://www.circuidipity.com/theme/images/favicon.ico" type="image/x-icon" />
        <!-- analytics -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-89591498-1', 'auto');
  ga('send', 'pageview');

</script>
</head>

<body>
        <!-- content -->

<!-- breadcrumb trail -->
<div id="breadcrumb">
    <p><a href="/"><img class="minime" src="/theme/images/minime.png" alt="Mini Me" height="38" width="38" /> Howdy!</a> &nbsp;<i class="fa fa-arrow-right"></i>&nbsp;
    Saturday 02 May 2015</p>
</div>

<!-- article -->
<h1>Chromebook to Ubuntubook</h1>
    <p class="modified"><i class="fa fa-wrench"></i>&nbsp; Last modified on Saturday 30 April 2016</p>
<div id="article">
    <p>Replace <strong>Chrome OS</strong> permanently with <strong>Ubuntu 16.04 &quot;Xenial Xerus&quot;</strong> on the <strong>Acer C720 Chromebook</strong>.</p>
<img alt="Ubuntu 16.04" class="align-right" src="images/jessiebook.png" style="width: 300px; height: 161px;" />
<div class="section" id="let-s-go">
<h2>Let's go!</h2>
<p>Running a full-featured Linux on this little laptop is a delight: lightweight, several hours battery life, inexpensive, and snappy performance. I started with <a class="reference external" href="http://www.circuidipity.com/c720-chromebook-to-jessiebook.html">Debian</a>, followed by <a class="reference external" href="http://www.circuidipity.com/c720-lubuntubook.html">Lubuntu 14.04</a> and <a class="reference external" href="http://www.circuidipity.com/arch-install-encrypt.html">Arch</a>, and now running happy with <a class="reference external" href="http://www.circuidipity.com/20160501.html">Ubuntu + i3 tiling window manager</a>.</p>
<p>This device is available in a few different configurations. Mine is the non-touchscreen model <tt class="docutils literal"><span class="pre">C720-2848</span></tt> with (non-expandable) <strong>2GB RAM</strong> and a (user-replaceable) <strong>16GB SSD</strong> <a class="footnote-reference" href="#id8" id="id1">[1]</a>.</p>
</div>
<div class="section" id="recovery-image">
<h2>0. Recovery Image</h2>
<p>Create a recovery image of Chrome OS (my C720 is model <tt class="docutils literal">PEPPY <span class="pre">C6A-N3C-A7O</span></tt>) to enable restoring the Chromebook to its default configuration. This will require a spare USB stick of 2GB or better:</p>
<ul class="simple">
<li>Log into the Chromebook and let it auto update, as there sometimes are firmware updates... check the updating status in the browser at <tt class="docutils literal"><span class="pre">chrome://help</span></tt></li>
<li>Insert the USB stick, enter <tt class="docutils literal"><span class="pre">chrome://imageburner</span></tt> and follow the directions to generate a recovery image</li>
</ul>
<p>See: <a class="reference external" href="https://support.google.com/chromebook/answer/1080595?hl=en">Create a Chromebook recovery image</a></p>
</div>
<div class="section" id="prepare-install-media">
<h2>1. Prepare install media</h2>
<p>Download the <a class="reference external" href="http://archive.ubuntu.com/ubuntu/dists/xenial/main/installer-amd64/current/images/netboot/">64-bit mini.iso installer</a> and <a class="reference external" href="https://help.ubuntu.com/community/Installation/FromUSBStick">flash the image</a> to a USB stick.</p>
<p><strong>Alternative:</strong> Add the image to a <a class="reference external" href="http://www.circuidipity.com/multi-boot-usb.html">USB stick with multiple Linux installers</a>.</p>
<p>Using the minimal console installer (requires network connection) vs. the graphical <a class="reference external" href="https://help.ubuntu.com/community/Ubuntu/GetUbuntu">Ubuntu installer</a> provides more options during setup <a class="footnote-reference" href="#id9" id="id2">[2]</a> and downloads all the latest packages.</p>
</div>
<div class="section" id="seabios">
<h2>2. SeaBIOS</h2>
<p><a class="reference external" href="http://www.coreboot.org/SeaBIOS">SeaBIOS</a> in combination with <strong>coreboot</strong> provides an open-source legacy BIOS that enables access to the MBR and the ability to install an alternative OS on the Chromebook. All this good stuff involves jumping through a few simple hoops and not trembling in fear at the &quot;scary white screen&quot; that pops up at power up stating that the boot loader detects something is <strong>very very wrong</strong> with the Chromebook and helpfully suggests pressing the spacebar to begin recovery. <strong>Do not press the spacebar</strong> or the Ubuntu installation will be wiped from disk!</p>
<p>There are 2 different methods for configuring SeaBIOS in preparation for installing Ubuntu. The first method uses a few simple commands in the Chrome OS shell to place the Chromebook into <strong>developer mode</strong> and allow booting the USB install media and replacing Chrome OS with Ubuntu. The drawback is that scary screen appears at every boot and you must press <tt class="docutils literal">CTRL+L</tt> to boot to legacy-mode and onward to GRUB and Ubuntu (and <strong>ignore</strong> the helpful prompt to press spacebar and inadvertently begin the adventure of wiping clean the SSD).</p>
<p>The second method involves setting new flags for the write-protected <strong>Google Binary Block</strong> (GBB) in the device firmware. Delay at the boot screen can be reduced to a one second timeout and the legacy-mode BIOS set as the system default (no key combo required). Pressing the spacebar is disabled from doing any harm to Ubuntu (the Chromebook just beeps). The drawback is that it involves the (very simple) removal of the device's bottom cover and the temporary removal of the <strong>write-protect screw</strong> from the motherboard to permit flashing new flags to the GBB... and this may void the Chromebook's warranty (one of the case screws lies underneath a sticker declaring the warranty void if disturbed).</p>
<p>Experimenting with alternate OS installs on the Chromebook I first employed the developer mode method followed by the write-protect screw removal. I prefer configuring the device to default to legacy-mode BIOS but I have employed both methods successfully and describe their respective steps below.</p>
<p>Happy hacking!</p>
<div class="section" id="write-protect-screw-method">
<h3>2.1 Write-Protect Screw Method</h3>
<p>Disconnect power. Turn the Chromebook over facing bottom up and remove the 13 screws (not missing the one hidden under the warranty sticker). Gently pry the case off starting with the seam where the display connects to device. It comes away pretty easy.</p>
<p>This is what you see ...</p>
<div class="figure">
<img alt="C720 annotated innards" src="images/c720-chromebook-annotated-innards.png" style="width: 800px; height: 558px;" />
<p class="caption">[ Image: <a class="footnote-reference" href="#id10" id="id4">[3]</a> The battery lock screw is #6 and the write-protect screw is #7 ].</p>
</div>
<p><span class="warning">WARNING!</span> This will <strong>wipe out</strong> whatever is installed on the SSD ...</p>
<ul class="simple">
<li>Remove the write-protect screw</li>
<li>Close back cover using only the battery lock screw to hold in place</li>
<li>Re-connect power, boot Chromebook and wait until it displays ...</li>
</ul>
<div class="highlight"><pre><span></span>Chrome OS is missing or damaged.
Please insert a recovery USB stick or SD card.
</pre></div>
<ul class="simple">
<li>Insert USB recovery media prepared in Step 0 and it will proceed to restore Chrome OS and reboot</li>
<li>At default Chrome OS &quot;Welcome!&quot; screen open a terminal <tt class="docutils literal">CTRL+ALT+F2</tt> (Right-arrow)</li>
<li>Login as <tt class="docutils literal">chronos</tt> (no password), then enter <tt class="docutils literal">sudo su</tt> for superuser access</li>
</ul>
<p>Set new GBB flags using the <tt class="docutils literal">set_gbb_flags.sh</tt> script in Chrome OS. To enable short <strong>developer mode</strong> screen (1 second timeout) followed by <strong>default legacy mode</strong> boot use these flags ...</p>
<div class="highlight"><pre><span></span>GBB_FLAG_DEV_SCREEN_SHORT_DELAY 0×00000001
GBB_FLAG_FORCE_DEV_SWITCH_ON 0×00000008
GBB_FLAG_FORCE_DEV_BOOT_LEGACY 0×00000080
GBB_FLAG_DEFAULT_DEV_BOOT_LEGACY 0×00000400
</pre></div>
<p>... which adds up to running in the shell ...</p>
<div class="highlight"><pre><span></span>/usr/share/vboot/bin/set_gbb_flags.sh 0x489
</pre></div>
<p>Shutdown with ...</p>
<div class="highlight"><pre><span></span><span class="c1"># shutdown -h now</span>
</pre></div>
<p>... and disconnect the power ...</p>
<ul class="simple">
<li>Remove the bottom cover again and reinstall the write-lock screw to protect the BIOS</li>
<li>Close cover and reinstall all the case screws</li>
</ul>
<p>Re-connect the power, insert the USB stick prepared in Step 1, and power up the Chromebook <a class="footnote-reference" href="#id11" id="id5">[4]</a>.</p>
<p>See: <a class="reference external" href="http://www.coreboot.org/pipermail/coreboot/2014-January/077083.html">Useful GBB flags</a> for <a class="reference external" href="https://blogs.fsfe.org/the_unconventional/2014/04/20/c720-debian/">another new free software machine</a></p>
</div>
<div class="section" id="developer-mode-method">
<h3>2.2 Developer Mode Method</h3>
<p>The alternative to removing the write-protect screw above is to place the Chromebook into developer mode using the Chrome OS shell before booting the USB install media ...</p>
<ul class="simple">
<li>With the Chromebook off... Hold down <tt class="docutils literal">ESC+F3</tt> (Refresh) keys and power on the device</li>
<li>Invoke Recovery, and at the Recovery screen press <tt class="docutils literal">Ctrl+D</tt></li>
<li>Device will prompt for confirmation, press <tt class="docutils literal">ENTER</tt> and the system reboots into developer mode</li>
<li>Scary white boot screen appears and you need to press <tt class="docutils literal">Ctrl+D</tt> to continue boot <a class="footnote-reference" href="#id12" id="id6">[5]</a></li>
</ul>
<p>Enable the <strong>USB Boot</strong> and <strong>Legacy BIOS</strong> modes by opening the shell with <tt class="docutils literal">Ctrl+Alt+T</tt> and enter <tt class="docutils literal">shell</tt>. Set <tt class="docutils literal">dev_boot_usb</tt> and <tt class="docutils literal">dev_boot_legacy</tt> to active ...</p>
<div class="highlight"><pre><span></span>$ sudo crossystem <span class="nv">dev_boot_usb</span><span class="o">=</span>1
$ sudo crossystem <span class="nv">dev_boot_legacy</span><span class="o">=</span>1
</pre></div>
<p>Insert the USB stick prepared in Step 1, reboot the Chromebook and press <tt class="docutils literal">CTRL+L</tt> at the boot screen to enter legacy boot mode.</p>
<p>See: <a class="reference external" href="http://www.chromium.org/chromium-os">Chromium OS</a> developer information for the <a class="reference external" href="http://www.chromium.org/chromium-os/developer-information-for-chrome-os-devices/acer-c720-chromebook">Acer C720 Chromebook</a></p>
</div>
</div>
<div class="section" id="install-ubuntu">
<h2>3. Install Ubuntu</h2>
<p>My <a class="reference external" href="http://www.circuidipity.com/ubuntu-trusty-install.html">visual screenshot tour</a> of installing Ubuntu 16.04 - a <a class="reference external" href="https://wiki.ubuntu.com/Releases">Long Term Support (LTS)</a> release. Ubuntu's minimal install image makes it easy to create a console-only base configuration that can be later customized for various tasks and alternate desktops. I like the <a class="reference external" href="http://www.circuidipity.com/20160501.html">lightweight and delightful i3 window manager</a>.</p>
<p>Chromebook's SSD will be divided into 3 partitions ...</p>
<ul class="simple">
<li>sda1 is a 300MB <tt class="docutils literal">boot</tt> partition</li>
<li>sda2 is a 1GB LUKS encrypted <tt class="docutils literal">swap</tt> partition using a <strong>random key</strong></li>
<li>sda3 uses the remaining space as a LUKS encrypted <tt class="docutils literal">root</tt> partition using a <strong>passphrase</strong></li>
</ul>
<p><strong>Update:</strong> I replaced the factory-installed SSD with a 256GB device and a revised partition scheme ...</p>
<ul class="simple">
<li>sda1 is a 24GB <tt class="docutils literal">root</tt> partition</li>
<li>sda2 is a 2GB LUKS encrypted <tt class="docutils literal">swap</tt> partition using a <strong>random key</strong></li>
<li>sda3 uses the remaining space as a LUKS encrypted <tt class="docutils literal">home</tt> partition using a <strong>passphrase</strong></li>
</ul>
</div>
<div class="section" id="touchpad">
<h2>4. Touchpad</h2>
<p>Ubuntu installs a kernel with built-in support for the Chromebook's touchpad. Per-session modifications of touchpad settings can be made using <tt class="docutils literal">synclient</tt> ...</p>
<div class="highlight"><pre><span></span>$ synclient                 <span class="c1"># display current settings</span>
$ synclient <span class="nv">TapButton3</span><span class="o">=</span><span class="m">2</span>    <span class="c1"># 3-finger tap = middle-click</span>
</pre></div>
<p>To make any desired touchpad settings permanent create a configuration file in <tt class="docutils literal">/etc/X11/xorg.conf.d</tt> ...</p>
<div class="highlight"><pre><span></span>$ sudo mkdir /etc/X11/xorg.conf.d
$ sudo cp /usr/share/X11/xorg.conf.d/50-synaptics.conf /etc/X11/xorg.conf.d/50-c720-touchpad.conf
</pre></div>
<p>Modify this file to adjust timeouts, add tap-mouse actions (2-finger tap = right-click, 3-finger tap = middle-click), and 2-finger scrolling.</p>
<p>Sample config ...</p>
<div class="highlight"><pre><span></span>Section <span class="s2">&quot;InputClass&quot;</span>
    Identifier      <span class="s2">&quot;touchpad peppy cyapa&quot;</span>
    MatchIsTouchpad <span class="s2">&quot;on&quot;</span>
    MatchDevicePath <span class="s2">&quot;/dev/input/event*&quot;</span>
    MatchProduct    <span class="s2">&quot;cyapa&quot;</span>
    Option          <span class="s2">&quot;FingerLow&quot;</span> <span class="s2">&quot;5&quot;</span>
    Option          <span class="s2">&quot;FingerHigh&quot;</span> <span class="s2">&quot;5&quot;</span>
    Option          <span class="s2">&quot;VertEdgeScroll&quot;</span> <span class="s2">&quot;0&quot;</span>
    Option          <span class="s2">&quot;VertTwoFingerScroll&quot;</span> <span class="s2">&quot;1&quot;</span>
    Option          <span class="s2">&quot;HorizTwoFingerScroll&quot;</span> <span class="s2">&quot;1&quot;</span>
    Option          <span class="s2">&quot;AreaRightEdge&quot;</span> <span class="s2">&quot;850&quot;</span>
    Option          <span class="s2">&quot;AreaLeftEdge&quot;</span> <span class="s2">&quot;50&quot;</span>
    Option          <span class="s2">&quot;TapButton1&quot;</span> <span class="s2">&quot;1&quot;</span>
    Option          <span class="s2">&quot;TapButton2&quot;</span> <span class="s2">&quot;3&quot;</span>
    Option          <span class="s2">&quot;TapButton3&quot;</span> <span class="s2">&quot;2&quot;</span>
EndSection
</pre></div>
<p><strong>Note:</strong> If using Ubuntu's default Unity desktop ... you may find the 3-finger middle-click option requires a manual reset each session.</p>
<p><strong>Fix:</strong> Stop the Gnome Settings daemon from overiding <tt class="docutils literal"><span class="pre">50-c720-touchpad.conf</span></tt> ...</p>
<div class="highlight"><pre><span></span>$ gsettings <span class="nb">set</span> org.gnome.settings-daemon.plugins.mouse active <span class="nb">false</span>
</pre></div>
<p>See: <a class="reference external" href="https://github.com/vonbrownie/linux-post-install/blob/master/config/c720_ubuntubook/etc/X11/xorg.conf.d/50-c720-touchpad.conf">50-c720-touchpad.conf</a>, and pages for <a class="reference external" href="https://wiki.archlinux.org/index.php/Touchpad_Synaptics">Touchpad Synaptics</a> and the <a class="reference external" href="https://wiki.archlinux.org/index.php/Acer_C720_Chromebook#configuration">C720 Chromebook</a> on <a class="reference external" href="https://wiki.archlinux.org/">ArchWiki</a></p>
</div>
<div class="section" id="ssd">
<h2>5. SSD</h2>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Swappiness">swappiness</a> parameter controls the preference of the kernel to move processes out of physical memory to the swap partition. Range is <tt class="docutils literal"><span class="pre">0-100</span></tt>, default is set to <tt class="docutils literal">60</tt> and lower values cause the kernel to avoid swapping and higher values prompt more frequent swap use.</p>
<p>Check the current swappiness value ...</p>
<div class="highlight"><pre><span></span>$ cat /proc/sys/vm/swappiness
</pre></div>
<p>To reduce writes on the SSD set a low value of <tt class="docutils literal">1</tt> by setting <tt class="docutils literal">vm.swappiness=1</tt> in <tt class="docutils literal">/etc/sysctl.conf</tt>.</p>
<p><strong>TRIM</strong> optimizes SSD performance and is enabled by adding the <tt class="docutils literal">discard</tt> option to <tt class="docutils literal">/etc/crypttab</tt> and <tt class="docutils literal">/etc/fstab</tt>. Ubuntu auto-magically configures <tt class="docutils literal">crypttab</tt> but <tt class="docutils literal">fstab</tt> needs to be set manually.</p>
<p>Sample <tt class="docutils literal">fstab</tt> ...</p>
<div class="highlight"><pre><span></span><span class="c1"># &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;</span>
<span class="c1"># / was on /dev/sda1 during installation</span>
<span class="nv">UUID</span><span class="o">=</span>&lt;______string___&gt;  /              ext4    relatime,discard,errors<span class="o">=</span>remount-ro <span class="m">0</span>       1
/dev/mapper/sda3_crypt /home           ext4    relatime,discard        <span class="m">0</span>       2
/dev/mapper/sda2_crypt none            swap    sw,discard              <span class="m">0</span>       0
</pre></div>
<p>After modifying <tt class="docutils literal">fstab</tt> update <tt class="docutils literal"><span class="pre">/boot/initrd.img-*</span></tt> by running ...</p>
<div class="highlight"><pre><span></span>$ sudo update-initramfs -u -k all
</pre></div>
<p>See: <a class="reference external" href="http://www.linuxjournal.com/content/solid-state-drives-get-one-already">TRIM configuration on solid-state drives</a></p>
</div>
<div class="section" id="suspend">
<h2>6. Suspend</h2>
<p><strong>Problem:</strong> Suspend-and-resume generates a stream of errors ...</p>
<div class="highlight"><pre><span></span>ehci-pci 0000:00:1d.0: port <span class="m">1</span> resume error -19
ehci-pci 0000:00:1d.0: port <span class="m">2</span> resume error -19
usb usb3-port1: over-current condition
usb usb3-port1: connect-debounce failed
usb usb3-port2: over-current condition
usb usb3-port2: connect-debounce failed
</pre></div>
<p>... and blocks the Chromebook from executing a proper restart/shutdown.</p>
<p><strong>FIX:</strong> Create <tt class="docutils literal"><span class="pre">/lib/systemd/system-sleep/ehci-pci.sh</span></tt> ...  <a class="footnote-reference" href="#id13" id="id7">[6]</a></p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="k">case</span> <span class="nv">$1</span>/<span class="nv">$2</span> in
    pre/*<span class="o">)</span>
    <span class="c1"># Unbind ehci for preventing error</span>
    <span class="nb">echo</span> -n <span class="s2">&quot;0000:00:1d.0&quot;</span> <span class="p">|</span> tee /sys/bus/pci/drivers/ehci-pci/unbind
    <span class="p">;;</span>
    post/*<span class="o">)</span>
    <span class="c1"># Bind ehci for preventing error</span>
    <span class="nb">echo</span> -n <span class="s2">&quot;0000:00:1d.0&quot;</span> <span class="p">|</span> tee /sys/bus/pci/drivers/ehci-pci/bind
    <span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
<p>... and make it executable ...</p>
<div class="highlight"><pre><span></span>$ sudo chmod <span class="m">755</span> /lib/systemd/system-sleep/ehci-pci.sh
</pre></div>
<p>Configure boot options in <tt class="docutils literal">/etc/default/grub</tt> ...</p>
<div class="highlight"><pre><span></span><span class="nv">GRUB_CMDLINE_LINUX_DEFAULT</span><span class="o">=</span><span class="s2">&quot;quiet splash tpm_tis.force=1&quot;</span>
</pre></div>
<p>... save the changes and run ...</p>
<div class="highlight"><pre><span></span>$ sudo update-grub
</pre></div>
<p>Suspend now works reliably when triggered from Ubuntu's shutdown menu or closing the lid and will resume the system with the desktop locked and a password prompt.</p>
<p>Source: <a class="reference external" href="https://github.com/vonbrownie/linux-post-install/blob/master/config/c720_ubuntubook/lib/systemd/system-sleep/ehci-pci.sh">ehci-pci.sh</a></p>
</div>
<div class="section" id="keyboard-shortcuts">
<h2>7. Keyboard Shortcuts</h2>
<p>Top row on the keyboard with the shortcut icons (brightness, volume, etc.) identify in Linux as the <tt class="docutils literal"><span class="pre">F1-F10</span></tt> keys and the Search key (in the <tt class="docutils literal">CapsLk</tt> position) acts as the <tt class="docutils literal">Super</tt> (Windows) modifier key.</p>
<p>Create keyboard shortcuts by first installing ...</p>
<ul class="simple">
<li><tt class="docutils literal">xbindkeys</tt> - associate keys to shell commands</li>
<li><tt class="docutils literal">xbacklight</tt> - set backlight level using RandR</li>
<li><tt class="docutils literal"><span class="pre">pulseaudio-utils</span></tt> - manage sound with <tt class="docutils literal">pactl</tt></li>
<li><tt class="docutils literal">xvkbd</tt> - send characters to another client</li>
</ul>
<div class="highlight"><pre><span></span>$ sudo apt install xbindkeys xbacklight pulseaudio-utils xvkbd
</pre></div>
<div class="section" id="direction-brightness-volume-page-keys">
<h3>7.1 Direction, Brightness, Volume, Page Keys</h3>
<div class="highlight"><pre><span></span>$ xbindkeys -k
</pre></div>
<p>Enable the function keys to modify the sound and brightness settings by creating <tt class="docutils literal"><span class="pre">~/.xbindkeysrc</span></tt> ...</p>
<div class="highlight"><pre><span></span><span class="c1"># ~/.xbindkeysrc</span>

<span class="c1"># backward/forward</span>
<span class="s2">&quot;xvkbd -xsendevent -text &quot;</span><span class="se">\A\[</span>Left<span class="o">]</span><span class="s2">&quot;&quot;</span>
F1

<span class="s2">&quot;xvkbd -xsendevent -text &quot;</span><span class="se">\A\[</span>Right<span class="o">]</span><span class="s2">&quot;&quot;</span>
F2

<span class="c1"># backlight decrease/increase</span>
<span class="s2">&quot;xbacklight -dec 10&quot;</span>
F6
<span class="s2">&quot;xbacklight -inc 10&quot;</span>
F7

<span class="c1"># volume mute/decrease/increase</span>
<span class="c1"># pactl - control a running pulseaudio server</span>
<span class="c1"># pactl list sinks - retrieve info</span>
<span class="c1"># on my c770 chromebook... single audio sink is &#39;Sink #0&#39;</span>
<span class="c1"># named &#39;alsa_output.pci-0000_00_1b.0.analog-stereo&#39;</span>
<span class="s2">&quot;pactl set-sink-mute alsa_output.pci-0000_00_1b.0.analog-stereo toggle&quot;</span>
F8
<span class="s2">&quot;pactl set-sink-volume alsa_output.pci-0000_00_1b.0.analog-stereo -10%&quot;</span>
F9
<span class="s2">&quot;pactl set-sink-volume alsa_output.pci-0000_00_1b.0.analog-stereo +10%&quot;</span>
F10

<span class="c1"># page up/down, home, end</span>
<span class="s2">&quot;xvkbd -xsendevent -text &#39;\[Page_Up]&#39;&quot;</span>
Alt + Up

<span class="s2">&quot;xvkbd -xsendevent -text &#39;\[Page_Down]&#39;&quot;</span>
Alt + Down

<span class="s2">&quot;xvkbd -xsendevent -text &#39;\[Home]&#39;&quot;</span>
Alt + Left

<span class="s2">&quot;xvkbd -xsendevent -text &#39;\[End]&#39;&quot;</span>
Alt + Right
</pre></div>
<p>Enable the new key shortcuts by running ...</p>
<div class="highlight"><pre><span></span>$ xbindkeys
</pre></div>
<p>Ubuntu auto-detects <tt class="docutils literal"><span class="pre">~/.xbindkeysrc</span></tt>  and will run <tt class="docutils literal">xbindkeys</tt> on the next login.</p>
<p>See: <a class="reference external" href="https://github.com/vonbrownie/dotfiles/blob/master/.xbindkeysrc.chromebook">xbindkeysrc</a>, <a class="reference external" href="https://wiki.archlinux.org/index.php/Xbindkeys">Xbindkeys</a>, and another sample <a class="reference external" href="https://github.com/alexpatel/dotfiles/blob/master/xbindkeysrc">Chromebook-friendly xbindkeysrc</a></p>
</div>
<div class="section" id="power-key">
<h3>7.2 Power Key</h3>
<p>Power key in upper-right corner ignores any configuration in the window manager and triggers poweroff without delay when pressed (easy to do by accident as its positioned next to <tt class="docutils literal">backspace</tt>).</p>
<p>If you want to disable the power key edit <tt class="docutils literal">/etc/systemd/logind.conf</tt> and set <tt class="docutils literal">HandlePowerKey=ignore</tt>.</p>
</div>
</div>
<div class="section" id="wireless">
<h2>8. Wireless</h2>
<p><strong>Update:</strong> With the &gt;= 4.2 kernels I have not been required to make any modifications. Works OK.</p>
<p>There are a few settings to modify to improve performance of Chromebook's wireless chipset. Identify the card and parameters ...</p>
<div class="highlight"><pre><span></span>$ lspci <span class="p">|</span> grep -i net
01:00.0 Network controller: Qualcomm Atheros AR9462 Wireless Network Adapter <span class="o">(</span>rev 01<span class="o">)</span>
$ modinfo ath9k <span class="p">|</span> grep parm
parm:           debug:Debugging mask <span class="o">(</span>uint<span class="o">)</span>
parm:           nohwcrypt:Disable hardware encryption <span class="o">(</span>int<span class="o">)</span>
parm:           blink:Enable LED blink on activity <span class="o">(</span>int<span class="o">)</span>
parm:           btcoex_enable:Enable wifi-BT coexistence <span class="o">(</span>int<span class="o">)</span>
parm:           bt_ant_diversity:Enable WLAN/BT RX antenna diversity <span class="o">(</span>int<span class="o">)</span>
parm:           ps_enable:Enable WLAN PowerSave <span class="o">(</span>int<span class="o">)</span>
parm:           use_chanctx:Enable channel context <span class="k">for</span> concurrency <span class="o">(</span>int<span class="o">)</span>
</pre></div>
<p>Create <tt class="docutils literal">/etc/modprobe.d/ath9k.conf</tt> with the following options ...</p>
<div class="highlight"><pre><span></span>options ath9k <span class="nv">bt_ant_diversity</span><span class="o">=</span><span class="m">1</span> <span class="nv">ps_enable</span><span class="o">=</span>0
</pre></div>
<p>See: <a class="reference external" href="https://github.com/vonbrownie/linux-post-install/blob/master/config/c720_ubuntubook/etc/modprobe.d/ath9k.conf">ath9k.conf</a>, <a class="reference external" href="http://wireless.kernel.org/en/users/Drivers/ath9k">ath9k wireless driver</a> and <a class="reference external" href="http://wireless.kernel.org/en/users/Drivers/ath9k/btcoex">bluetooth coexistence</a></p>
</div>
<div class="section" id="microphone">
<h2>9. Microphone</h2>
<p>Confirm the microphone is un-muted in <tt class="docutils literal">alsamixer</tt>. Create <tt class="docutils literal"><span class="pre">/etc/modprobe.d/snd-hda-intel.conf</span></tt> ...</p>
<div class="highlight"><pre><span></span>options snd_hda_intel <span class="nv">model</span><span class="o">=</span>,alc283-dac-wcaps
</pre></div>
<p>... and restart. Give it a try ...</p>
<div class="highlight"><pre><span></span>$ arecord -d <span class="m">5</span> chr-mic.wav
$ aplay chr-mic.wav
</pre></div>
</div>
<div class="section" id="good-stuff">
<h2>10. Good stuff</h2>
<ul class="simple">
<li>My former <a class="reference external" href="http://www.circuidipity.com/c720-lubuntubook.html">Lubuntu 14.04 LTS install on the Chromebook</a> and configuration (under <tt class="docutils literal">upstart</tt> init vs <tt class="docutils literal">systemd</tt> in the current 15.10)</li>
<li>Arch Linux C720 installation with <a class="reference external" href="https://wiki.archlinux.org/index.php/Acer_C720_Chromebook">useful post-install details</a></li>
<li>Turn Chromebooks into <a class="reference external" href="http://blog.codestarter.org/post/93985346780/how-we-turn-199-chromebooks-into-ubuntu-based-code">Ubuntu-based code learning machines for kids</a></li>
<li>Lightweight <a class="reference external" href="http://www.circuidipity.com/i3-tiling-window-manager.html">i3 tiling window manager</a> is snappy on the Chromebook's modest hardware</li>
</ul>
<p>Happy hacking!</p>
<div class="section" id="notes">
<h3>Notes</h3>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Device information <a class="reference external" href="https://github.com/vonbrownie/linux-post-install/tree/master/config/c720_ubuntubook/doc">output of lshw, lspci, and lsusb</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Specifically in this instance, the Ubuntu console installer provides a random key option for the encrypted swap partition.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[3]</a></td><td>Image courtesy of <a class="reference external" href="http://www.chromium.org/chromium-os/developer-information-for-chrome-os-devices/acer-c720-chromebook#TOC-Firmware">Chromium</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[4]</a></td><td>Whenever you remove battery power to the Chromebook (like opening up the case) the hardware clock on the motherboard resets to a future year (mine travelled to 2040). Providing a network connection is up during the Ubuntu installation the system should fetch a correct time from a NTP server. Otherwise fix the <a class="reference external" href="https://blogs.fsfe.org/the_unconventional/2014/04/20/c720-debian/">fallout from an incorrect clock</a> by re-mounting partitions read-only and correct filesystem timestamps using <tt class="docutils literal">fsck</tt>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[5]</a></td><td>Switching between developer and normal (non-developer) modes will remove user accounts and their associated information from the Chromebook.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[6]</a></td><td>Some HOWTOs talk about adding <tt class="docutils literal">modprobe.blacklist=ehci_hcd,ehci_pci</tt> but in Ubuntu they are compiled into the kernel.</td></tr>
</tbody>
</table>
</div>
</div>

    <p class="articletags"><i class="fa fa-coffee"></i> More         &#8226; <a class="tag" href="http://www.circuidipity.com/tag-chromebook.html">chromebook</a>
        &#8226; <a class="tag" href="http://www.circuidipity.com/tag-ubuntu.html">ubuntu</a>
        &#8226; <a class="tag" href="http://www.circuidipity.com/tag-linux.html">linux</a>
</p>
</div>

<!-- Nav links to previous|next article -->
<div id="navmenu">
    <hr />
    <p class="prevpost"><i class="fa fa-arrow-left"></i> Older<br />
        <a href="http://www.circuidipity.com/encrypt-external-drive.html">Configure an encrypted external USB hard drive in Linux</a></p>
    <p class="nextpost">Newer <i class="fa fa-arrow-right"></i><br />
        <a href="http://www.circuidipity.com/openwrt-bridged-repeater.html">OpenWrt router as bridged repeater using relayd</a></p>
</div>


        <!-- footer -->
<div id="footer">
    <img class="imgfooter" src="./theme/images/footerbar.png" />
    <p class="contentinfo">
    <span class="noWrap">
        Copyright &#169; 2017 and
        <a rel="license" class="ccLicense" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA License</a> by
        <a rel="author" class="authorID" href="/">Daniel Wayne Armstrong</a>
    </span>
    <span class="noWrap">
        <i class="fa fa-globe"></i>
        Find me at <span class="whoa">daniel at circuidipity dot com</span>
    </span>
    <br />
    Don't miss a thing... updates by
    <a href="feed.xml">RSS</a> and
    <a class="subTweat" href="https://twitter.com/circuidipity">Twitter</a>
    </p>
</div></body>
</html>