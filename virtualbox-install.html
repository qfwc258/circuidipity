<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
        <title>Circuidipity | Virtualbox</title>
        <meta http-equiv="content-type" content="text/html"; charset="utf-8" />
        <meta http-equiv="pragma" content="no-cache" />
        <meta name="author" content="Daniel Wayne Armstrong" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/css/main.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/css/pygment.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/css/font.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/images/icons/font-awesome/css/font-awesome.min.css">
        <link rel="icon" href="http://www.circuidipity.com/theme/images/favicon.ico" type="image/x-icon" />
</head>

<body>
        <!-- content -->

<!-- breadcrumb trail -->
<div id="breadcrumb">
    <p><a href="/"><img class="minime" src="/theme/images/minime.png" alt="Mini Me" height="38" width="38" /> Howdy!</a> &nbsp;<i class="fa fa-arrow-right"></i>&nbsp;
    Friday 07 December 2012</p>
</div>

<!-- article -->
<h1>Virtualbox</h1>
    <p class="modified"><i class="fa fa-wrench"></i>&nbsp; Last modified on Friday 26 February 2016</p>
<div id="article">
    <p><a class="reference external" href="https://www.virtualbox.org/">Virtualbox</a> is virtualization software that allows a Linux user to HOST multiple GUEST operating systems as <a class="reference external" href="http://www.circuidipity.com/tag-vm.html">virtual machines (VMs)</a>. Its a cool tool for playing with different Linux distros and experimenting with configurations.</p>
<div class="section" id="let-s-go">
<h2>Let's go!</h2>
<p>In this HOWTO I install Virtualbox on a 64-bit <a class="reference external" href="http://www.circuidipity.com/tag-debian.html">Debian</a> HOST and create a Debian GUEST virtual machine.</p>
<div class="section" id="install-virtualbox-on-host">
<h3>0. Install VirtualBox on HOST</h3>
<div class="highlight"><pre>$ sudo apt-get install build-essential dkms module-assistant linux-headers-<span class="k">$(</span>uname -r<span class="k">)</span>
$ sudo apt-get install virtualbox virtualbox-dkms virtualbox-qt
</pre></div>
<p>Virtualbox kernel modules are built via <strong>Dynamic Kernel Module Support</strong> (<a class="reference external" href="http://en.wikipedia.org/wiki/Dynamic_Kernel_Module_Support">DKMS</a>). After installing the virtualbox packages the <tt class="docutils literal">vbox</tt> modules should be auto-built and -loaded:</p>
<div class="highlight"><pre>$ lsmod <span class="p">|</span> grep vbox
vboxpci                <span class="m">19066</span>  0
vboxnetadp             <span class="m">13155</span>  0
vboxnetflt             <span class="m">23571</span>  0
vboxdrv               <span class="m">190057</span>  <span class="m">4</span> vboxnetflt,vboxnetadp,vboxpci
</pre></div>
<p>I add my USERNAME to the <tt class="docutils literal">vboxusers</tt> group:</p>
<div class="highlight"><pre>$ sudo adduser USERNAME vboxusers
</pre></div>
</div>
<div class="section" id="create-the-guest">
<h3>1. Create the GUEST</h3>
<p><strong>Default Machine Folder</strong> where VM images are stored is <tt class="docutils literal">~/Virtualbox VMs</tt> (this can be modified in <tt class="docutils literal"><span class="pre">File-&gt;Preferences-&gt;General</span></tt>).</p>
<p>See the <a class="reference external" href="http://www.virtualbox.org/manual/UserManual.html">User Manual</a> for creating a GUEST virtual machine. I use the <a class="reference external" href="http://www.circuidipity.com/minimal-debian.html">mini.iso installer</a> to create a new virtual machine with a minimal system configuration.</p>
</div>
<div class="section" id="guest-additions">
<h3>2. GUEST additions</h3>
<p><strong>Guest Additions</strong> provide extra features such as the ability to tweak display settings and add a shared folder that can accessed by both HOST and GUEST machines.</p>
<p>Install on GUEST:</p>
<div class="highlight"><pre>$ sudo apt-get install virtualbox-guest-<span class="o">{</span>dkms,utils,x11<span class="o">}</span>
$ sudo adduser USERNAME vboxsf
</pre></div>
<p>I ran into a situation with Debian 32-bit virtual machine where the installer created virtualbox kernel modules for <tt class="docutils literal"><span class="pre">linux-image-686-pae</span></tt> but not the <tt class="docutils literal">486</tt> kernel I ended up using. Confirm that the current kernel has the necessary modules:</p>
<div class="highlight"><pre>$ modinfo /lib/modules/<span class="k">$(</span>uname -r<span class="k">)</span>/updates/dkms/vbox*
</pre></div>
<p>If they are missing like they were for me ... use DKMS to build them:</p>
<div class="highlight"><pre>$ sudo apt-get install build-essential dkms module-assistant linux-headers-<span class="k">$(</span>uname -r<span class="k">)</span>
$ sudo m-a prepare
</pre></div>
<p>If the virtualbox modules need to be rebuilt for any reason for the running kernel:</p>
<div class="highlight"><pre>$ uname -r <span class="p">|</span> sudo xargs -n1 /usr/lib/dkms/dkms_autoinstaller start
</pre></div>
<p>Reboot GUEST and <tt class="docutils literal">vbox</tt> drivers should now be loaded:</p>
<div class="highlight"><pre>$ lsmod <span class="p">|</span> grep vbox
vboxguest
vboxsf
vboxvideo
</pre></div>
</div>
<div class="section" id="extra-configuration">
<h3>3. Extra configuration</h3>
<div class="section" id="display">
<h4>3.1 Display</h4>
<p>Tweak display settings by going to the Virtualbox <tt class="docutils literal"><span class="pre">Machine-&gt;Settings...-&gt;Display</span></tt> setting and move the slider to add more video memory and enable 3d acceleration.</p>
<img alt="Display Settings" src="images/20121207-display.png" style="width: 662px; height: 502px;" />
<p>With VirtualBox guest additions the display and resolution can be changed when running X:</p>
<div class="highlight"><pre>$ ps aux <span class="p">|</span> grep VBox
/usr/sbin/VBoxService
/usr/bin/VBoxClient --clipboard
/usr/bin/VBoxClient --display
/usr/bin/VBoxClient --seamless
</pre></div>
<p>If GUEST does not use a graphical login manager to launch its desktop then modify <tt class="docutils literal"><span class="pre">$HOME/.xinitrc</span></tt> to start VBoxClient services:</p>
<div class="highlight"><pre>VBoxClient --clipboard <span class="p">&amp;</span>
VBoxClient --display <span class="p">&amp;</span>
VBoxClient --seamless <span class="p">&amp;</span>
</pre></div>
</div>
<div class="section" id="console">
<h4>3.2 Console</h4>
<p>Debian GUEST in console mode defaults to a small 80x40 window. Resize by rebooting GUEST and:</p>
<ul class="simple">
<li>GRUB screen: hit <tt class="docutils literal">c</tt> to enter command mode</li>
<li><tt class="docutils literal">grub&gt;</tt>: run <tt class="docutils literal">vbeinfo</tt> to display supported resolutions (example: <tt class="docutils literal">1152x864x32</tt>)</li>
<li><tt class="docutils literal">/etc/default/grub</tt>: add <tt class="docutils literal">GRUB_GFXMODE=1152x864x32</tt> and <tt class="docutils literal">GRUB_GFXPAYLOAD_LINUX=keep</tt></li>
<li>save changes: run <tt class="docutils literal"><span class="pre">update-grub</span></tt> and reboot</li>
</ul>
</div>
<div class="section" id="shared-folder">
<h4>3.3 Shared folder</h4>
<p>Create a shared folder on HOST. Make it accessible to GUEST by going to <tt class="docutils literal"><span class="pre">Machine-&gt;Settings...-&gt;Shared</span> Folders</tt> and click <tt class="docutils literal">Add Shared Folder</tt> and <tt class="docutils literal"><span class="pre">Auto-Mount</span></tt>.</p>
<img alt="Shared Folder Settings" src="images/20121207-shared-folders.png" style="width: 662px; height: 502px;" />
</div>
<div class="section" id="ssh-from-host-to-guest">
<h4>3.4 SSH from HOST to GUEST</h4>
<p><a class="reference external" href="http://christophermaier.name/blog/2010/09/01/host-only-networking-with-virtualbox">Host-only networking with Virtualbox</a> was a big help getting this properly configured.</p>
<p>Scenario: I want to SSH from my HOST to GUEST. Default configuration supplies GUEST with a NAT interface for internet access but no HOST&lt;-&gt;GUEST connectivity. A solution for local access is creating a <strong>host-only adapter</strong>.</p>
</div>
<div class="section" id="host">
<h4>Host</h4>
<p>Navigate to Virtualbox's <tt class="docutils literal"><span class="pre">File-&gt;Preferences-&gt;Network</span></tt>, select <tt class="docutils literal"><span class="pre">Host-only</span> Networks</tt>, click <tt class="docutils literal">Adds new <span class="pre">host-only</span> network</tt> to create <tt class="docutils literal">vboxnet0</tt>. Default setup is interface address <tt class="docutils literal">192.168.56.1</tt> with DHCP enabled.</p>
<p>Select the GUEST VM and in <tt class="docutils literal"><span class="pre">Machine-&gt;Settings-&gt;Network</span></tt> click on <tt class="docutils literal">Adapter 2</tt>, enable network adapter attached to <tt class="docutils literal"><span class="pre">Host-only</span> Adapter</tt>, and select <tt class="docutils literal">vboxnet0</tt>.</p>
</div>
<div class="section" id="guest">
<h4>Guest</h4>
<p>Boot the VM and confirm the new interface has been created. Add the interface to <tt class="docutils literal">/etc/network/interfaces</tt> (example: <tt class="docutils literal">enp0s8</tt>) ...</p>
<div class="highlight"><pre>auto enp0s8
iface enp0s8 inet dhcp
</pre></div>
<p>Install the SSH server ...</p>
<div class="highlight"><pre>$ sudo apt install openssh-server
</pre></div>
<p>Reboot GUEST. The second interface has been assigned address <tt class="docutils literal">192.168.56.101</tt> by DHCP and can now be accessed from HOST via SSH.</p>
<p><strong>Optional:</strong> Assign GUEST a static address outside the range of the Virtualbox DHCP server (101-254 by default) ...</p>
<div class="highlight"><pre>allow-hotplug enp0s8
<span class="c1">#iface enp3s0 inet dhcp</span>
iface enp0s8 inet static
address 192.168.56.50
netmask 255.255.255.0
network 192.168.56.0
broadcast 192.168.56.255
</pre></div>
<p>... and modify <tt class="docutils literal">/etc/hosts</tt> on HOST by adding the VM static address.</p>
<p>Happy hacking!</p>
</div>
</div>
</div>

    <p class="articletags"><i class="fa fa-coffee"></i> More         &#8226; <a class="tag" href="http://www.circuidipity.com/tag-virtualbox.html">virtualbox</a>
        &#8226; <a class="tag" href="http://www.circuidipity.com/tag-debian.html">debian</a>
        &#8226; <a class="tag" href="http://www.circuidipity.com/tag-linux.html">linux</a>
</p>
</div>

<!-- Nav links to previous|next article -->
<div id="navmenu">
    <hr />
    <p class="prevpost"><i class="fa fa-arrow-left"></i> Older<br />
        <a href="http://www.circuidipity.com/multi-boot-usb.html">Transform a USB stick into a boot device packing multiple Linux distros</a></p>
    <p class="nextpost">Newer <i class="fa fa-arrow-right"></i><br />
        <a href="http://www.circuidipity.com/mtp.html">Configure MTP in Linux</a></p>
</div>


        <!-- footer -->
<div id="footer">
    <img class="imgfooter" src="./theme/images/footerbar.png" />
    <p class="contentinfo">
    <span class="noWrap">
        Copyright &#169; 2016 and
        <a rel="license" class="ccLicense" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA License</a> by
        <a rel="author" class="authorID" href="/">Daniel Wayne Armstrong</a>
    </span>
    <span class="noWrap">
        <i class="fa fa-globe"></i>
        Find me at <span class="whoa">daniel at circuidipity dot com</span>
    </span>
    <br />
    Don't miss a thing... updates by
    <a href="feed.xml">RSS</a> and
    <a class="subTweat" href="https://twitter.com/circuidipity">Twitter</a>
    </p>
</div></body>
</html>