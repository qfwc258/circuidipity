<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
        <title>Circuidipity | Transform a USB stick into a boot device packing multiple Linux distros</title>
        <meta http-equiv="content-type" content="text/html"; charset="utf-8" />
        <meta http-equiv="pragma" content="no-cache" />
        <meta name="author" content="Daniel Wayne Armstrong" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/css/main.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/css/pygment.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/css/font.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/images/icons/font-awesome/css/font-awesome.min.css">
        <link rel="icon" href="http://www.circuidipity.com/theme/images/favicon.ico" type="image/x-icon" />
</head>

<body>
        <!-- content -->

<!-- breadcrumb trail -->
<div id="breadcrumb">
    <p><a href="/"><img class="minime" src="/theme/images/minime.png" alt="Mini Me" height="38" width="38" /> Howdy!</a> &nbsp;<i class="fa fa-arrow-right"></i>&nbsp;
    Thursday 06 December 2012</p>
</div>

<!-- article -->
<h1>Transform a USB stick into a boot device packing multiple Linux distros</h1>
    <p class="modified"><i class="fa fa-wrench"></i>&nbsp; Last modified on Thursday 26 February 2015</p>
<div id="article">
    <p>In 5 easy steps I transform a standard USB stick into a dual-purpose device that is both a storage medium usable under Linux, Windows, and Mac OS and a GRUB boot device packing multiple Linux distros.</p>
<p><span class="warning">WARNING!</span> In this HOWTO the USB stick is identified as <strong>sdX</strong> and contains a single partition <strong>sdX1</strong>. Make careful note of the drive and partition labels on your system. The following steps will <strong>destroy all data</strong> currently stored on the device.</p>
<div class="section" id="let-s-go">
<h2>Let's go!</h2>
</div>
<div class="section" id="select-device-and-create-filesystem">
<h2>0. Select device and create filesystem</h2>
<p>Create a <tt class="docutils literal">FAT32</tt> partition on the unmounted USB stick:</p>
<div class="highlight"><pre><span></span>$ sudo mkfs.vfat -n MULTIBOOT /dev/sdX1
</pre></div>
</div>
<div class="section" id="create-boot-and-iso-folders">
<h2>1. Create boot and iso folders</h2>
<p>New <tt class="docutils literal">FAT32</tt> partition is mounted and I create a <tt class="docutils literal">boot</tt> folder for GRUB and a <tt class="docutils literal">iso</tt> folder to hold Linux distro images. Example using <tt class="docutils literal">/media/USB0</tt> as mountpoint:</p>
<div class="highlight"><pre><span></span>$ mkdir /media/USB0/<span class="o">{</span>boot,iso<span class="o">}</span>
</pre></div>
</div>
<div class="section" id="install-grub">
<h2>2. Install GRUB</h2>
<p>Install GRUB to the <strong>Master Boot Record (MBR)</strong> of the USB stick:</p>
<div class="highlight"><pre><span></span>$ sudo grub-install --force --no-floppy --root-directory<span class="o">=</span>/media/USB0 /dev/sdX
</pre></div>
</div>
<div class="section" id="copy-linux-images">
<h2>3. Copy Linux images</h2>
<p>Download and copy Linux ISO images to the newly-created <tt class="docutils literal">iso</tt> folder on the USB stick. For example I have installed on my own USB stick:</p>
<ul class="simple">
<li><strong>GParted Live CD</strong> - <a class="reference external" href="http://gparted.sourceforge.net/livecd.php">Graphical partition editor</a> for hard drives</li>
<li><strong>Darik's Boot and Nuke (DBAN)</strong> - <a class="reference external" href="http://www.dban.org/">Secure deletion tool</a> to wipe hard disks clean <a class="footnote-reference" href="#id4" id="id1">[1]</a></li>
<li><strong>Debian Wheezy Mini-Installers</strong> - Minimal (~25MB) <a class="reference external" href="http://ftp.us.debian.org/debian/dists/stable/main/installer-amd64/current/images/netboot/">64bit</a> and <a class="reference external" href="http://ftp.us.debian.org/debian/dists/stable/main/installer-i386/current/images/netboot/">32bit</a> <tt class="docutils literal">mini.iso</tt> installers</li>
<li><strong>Ubuntu 14.04 LTS Mini-Installers</strong> - <a class="reference external" href="http://archive.ubuntu.com/ubuntu/dists/trusty/main/installer-amd64/current/images/netboot/">64bit mini.iso</a> and <a class="reference external" href="http://archive.ubuntu.com/ubuntu/dists/trusty/main/installer-i386/current/images/netboot/">32bit mini.iso</a></li>
<li><strong>Memtest86+</strong> - Diagnostic tool for <a class="reference external" href="http://www.memtest.org/">testing RAM</a></li>
</ul>
</div>
<div class="section" id="create-grub-cfg">
<h2>4. Create grub.cfg</h2>
<p>Create a <tt class="docutils literal">grub.cfg</tt> with entries for the Linux images copied to the USB stick. Each distro is a little bit different in the manner its booted by GRUB. Using my own example above I have created:</p>
<div class="highlight"><pre><span></span><span class="c1"># Config for GNU GRand Unified Bootloader (GRUB)</span>
<span class="c1"># /boot/grub/grub.cfg</span>

<span class="c1"># Timeout for menu</span>
<span class="nb">set</span> <span class="nv">timeout</span><span class="o">=</span>30

<span class="c1"># Default boot entry</span>
<span class="nb">set</span> <span class="nv">default</span><span class="o">=</span>0

<span class="c1"># Menu Colours</span>
<span class="nb">set</span> <span class="nv">menu_color_normal</span><span class="o">=</span>white/black
<span class="nb">set</span> <span class="nv">menu_color_highlight</span><span class="o">=</span>white/green

<span class="c1"># Path to the partition holding ISO images (using UUID)</span>
<span class="c1">#set imgdevpath=&quot;/dev/disk/by-uuid/UUID_value&quot;</span>
<span class="c1"># ... or...</span>
<span class="c1"># Path to the partition holding ISO images (using device labels)</span>
<span class="c1">#set imgdevpath=&quot;/dev/disk/by-label/label_value&quot;</span>
<span class="nb">set</span> <span class="nv">imgdevpath</span><span class="o">=</span><span class="s2">&quot;/dev/disk/by-label/MULTIBOOT&quot;</span>

<span class="c1"># Boot ISOs</span>
menuentry <span class="s2">&quot;GParted Live - Partition Editor&quot;</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">iso</span><span class="o">=</span><span class="s2">&quot;/iso/gparted-live-0.20.0-2-i486.iso&quot;</span>
    loopback loop <span class="nv">$iso</span>
    linux <span class="o">(</span>loop<span class="o">)</span>/live/vmlinuz <span class="nv">boot</span><span class="o">=</span>live config <span class="nv">union</span><span class="o">=</span>aufs noswap noprompt <span class="nv">ip</span><span class="o">=</span>frommedia <span class="nv">toram</span><span class="o">=</span>filesystem.squashfs <span class="nv">findiso</span><span class="o">=</span><span class="nv">$iso</span>
    initrd <span class="o">(</span>loop<span class="o">)</span>/live/initrd.img
<span class="o">}</span>

menuentry <span class="s2">&quot;Darik&#39;s Boot and Nuke - Hard Disk Wipe&quot;</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">iso</span><span class="o">=</span><span class="s2">&quot;/iso/dban-2.2.8_i586.iso&quot;</span>
    loopback loop <span class="nv">$iso</span>
    linux <span class="o">(</span>loop<span class="o">)</span>/DBAN.BZI <span class="nv">nuke</span><span class="o">=</span><span class="s2">&quot;dwipe&quot;</span>
<span class="o">}</span>

menuentry <span class="s2">&quot;Debian Wheezy - 64bit Mini-Installer&quot;</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">iso</span><span class="o">=</span><span class="s2">&quot;/iso/debian-wheezy-amd64-mini.iso&quot;</span>
    loopback loop <span class="nv">$iso</span>
    linux <span class="o">(</span>loop<span class="o">)</span>/linux
    initrd <span class="o">(</span>loop<span class="o">)</span>/initrd.gz
<span class="o">}</span>

menuentry <span class="s2">&quot;Debian Wheezy - 32bit Mini-Installer&quot;</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">iso</span><span class="o">=</span><span class="s2">&quot;/iso/debian-wheezy-i386-mini.iso&quot;</span>
    loopback loop <span class="nv">$iso</span>
    linux <span class="o">(</span>loop<span class="o">)</span>/linux
    initrd <span class="o">(</span>loop<span class="o">)</span>/initrd.gz
<span class="o">}</span>

menuentry <span class="s2">&quot;Ubuntu 14.04 LTS - 64bit Mini-Installer&quot;</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">iso</span><span class="o">=</span><span class="s2">&quot;/iso/ubuntu-14.04-amd64-mini.iso&quot;</span>
    loopback loop <span class="nv">$iso</span>
    linux <span class="o">(</span>loop<span class="o">)</span>/linux <span class="nv">boot</span><span class="o">=</span>casper iso-scan/filename<span class="o">=</span><span class="nv">$iso</span> noprompt noeject
    initrd <span class="o">(</span>loop<span class="o">)</span>/initrd.gz
<span class="o">}</span>

menuentry <span class="s2">&quot;Ubuntu 14.04 LTS - 32bit Mini-Installer&quot;</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">iso</span><span class="o">=</span><span class="s2">&quot;/iso/ubuntu-14.04-i386-mini.iso&quot;</span>
    loopback loop <span class="nv">$iso</span>
    linux <span class="o">(</span>loop<span class="o">)</span>/linux <span class="nv">boot</span><span class="o">=</span>casper iso-scan/filename<span class="o">=</span><span class="nv">$iso</span> noprompt noeject
    initrd <span class="o">(</span>loop<span class="o">)</span>/initrd.gz
<span class="o">}</span>

menuentry <span class="s2">&quot;Ubuntu 14.04 LTS - 32bit Installer (&#39;forcepae&#39; for Pentium M)&quot;</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">iso</span><span class="o">=</span><span class="s2">&quot;/iso/ubuntu-14.04-i386-mini.iso&quot;</span>
    loopback loop <span class="nv">$iso</span>
    linux <span class="o">(</span>loop<span class="o">)</span>/linux <span class="nv">boot</span><span class="o">=</span>casper iso-scan/filename<span class="o">=</span><span class="nv">$iso</span> noprompt noeject forcepae
    initrd <span class="o">(</span>loop<span class="o">)</span>/initrd.gz
<span class="o">}</span>

menuentry <span class="s2">&quot;Memtest86+ - RAM Tester&quot;</span> <span class="o">{</span>
    linux16 /boot/memtest86+-4.20.bin
<span class="o">}</span>
</pre></div>
<p>Save <tt class="docutils literal">grub.cfg</tt> to the USB stick at <tt class="docutils literal">/media/my_username/boot/grub</tt>.</p>
<p>All done! Reboot, select the USB stick (depends on BIOS) as boot device and GRUB will display a menu of the installed Linux distro images. Reboot again and return to using your USB stick as a regular storage device.</p>
</div>
<div class="section" id="grubs-reanimated-usb-boot-stick">
<h2>5. GRUBS Reanimated USB Boot Stick</h2>
<p>I created the <a class="reference external" href="https://github.com/vonbrownie/grubs">GRUBS shell script</a> that creates multi-boot Linux USB sticks using the above steps and placed it on GitHub.</p>
<p>Happy hacking!</p>
<div class="section" id="notes">
<h3>Notes</h3>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>When using DBAN remove the USB stick immediately when the boot messages begin to scroll past... otherwise it will scan for USB drives and later fail when selecting a hard drive to wipe.</td></tr>
</tbody>
</table>
</div>
</div>

    <p class="articletags"><i class="fa fa-coffee"></i> More         &#8226; <a class="tag" href="http://www.circuidipity.com/tag-shell.html">shell</a>
        &#8226; <a class="tag" href="http://www.circuidipity.com/tag-programming.html">programming</a>
        &#8226; <a class="tag" href="http://www.circuidipity.com/tag-linux.html">linux</a>
</p>
</div>

<!-- Nav links to previous|next article -->
<div id="navmenu">
    <hr />
    <p class="prevpost"><i class="fa fa-arrow-left"></i> Older<br />
        <a href="http://www.circuidipity.com/great-fun-getting-started-with-jekyll.html">Great fun getting started with Jekyll</a></p>
    <p class="nextpost">Newer <i class="fa fa-arrow-right"></i><br />
        <a href="http://www.circuidipity.com/virtualbox-install.html">Virtualbox</a></p>
</div>


        <!-- footer -->
<div id="footer">
    <img class="imgfooter" src="./theme/images/footerbar.png" />
    <p class="contentinfo">
    <span class="noWrap">
        Copyright &#169; 2016 and
        <a rel="license" class="ccLicense" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA License</a> by
        <a rel="author" class="authorID" href="/">Daniel Wayne Armstrong</a>
    </span>
    <span class="noWrap">
        <i class="fa fa-globe"></i>
        Find me at <span class="whoa">daniel at circuidipity dot com</span>
    </span>
    <br />
    Don't miss a thing... updates by
    <a href="feed.xml">RSS</a> and
    <a class="subTweat" href="https://twitter.com/circuidipity">Twitter</a>
    </p>
</div></body>
</html>