<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
        <title>Circuidipity | Transform a USB stick into a boot device packing multiple Linux distros</title>
        <meta http-equiv="content-type" content="text/html"; charset="utf-8" />
        <meta http-equiv="pragma" content="no-cache" />
        <meta name="author" content="Daniel Wayne Armstrong" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/css/main.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/css/pygment.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/css/font.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://www.circuidipity.com/theme/images/icons/font-awesome/css/font-awesome.min.css">
        <link rel="icon" href="http://www.circuidipity.com/theme/images/favicon.ico" type="image/x-icon" />
        <!-- analytics -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-89591498-1', 'auto');
  ga('send', 'pageview');

</script>
</head>

<body>
        <!-- content -->

<!-- breadcrumb trail -->
<div id="breadcrumb">
    <p><a href="/"><img class="minime" src="/theme/images/minime.png" alt="Mini Me" height="38" width="38" /> Howdy!</a> &nbsp;<i class="fa fa-arrow-right"></i>&nbsp;
    Thursday 06 December 2012</p>
</div>

<!-- article -->
<h1>Transform a USB stick into a boot device packing multiple Linux distros</h1>
    <p class="modified"><i class="fa fa-wrench"></i>&nbsp; Last modified on Friday 21 April 2017</p>
<div id="article">
    <p>Transform a standard USB stick into a dual-purpose device that is both a storage medium usable under Linux, Windows, and Mac OS and a GRUB boot device packing multiple Linux distros.</p>
<div class="section" id="let-s-go">
<h2>Let's go!</h2>
<p><span class="warning">WARNING!</span> In this HOWTO the USB device is identified as <strong>sdX</strong> and contains a single partition <strong>sdX1</strong>. Make careful note of the drive and partition labels on your system. The following steps will <strong>destroy all data</strong> currently stored on the device.</p>
<div class="section" id="format">
<h3>0. Format</h3>
<p>Create a <tt class="docutils literal">FAT32</tt> partition on the <strong>unmounted</strong> USB device ...</p>
<div class="highlight"><pre><span></span>$ sudo mkfs.vfat -n MULTIBOOT /dev/sdX1
</pre></div>
</div>
<div class="section" id="boot-and-iso">
<h3>1. Boot and iso</h3>
<p>Mount the USB device to MOUNTPOINT and create a <tt class="docutils literal">boot</tt> folder for GRUB files and a <tt class="docutils literal">iso</tt> folder to hold Linux distro images ...</p>
<div class="highlight"><pre><span></span>$ mkdir -p /media/MOUNTPOINT/boot/<span class="o">{</span>grub,iso,debian<span class="o">}</span>
</pre></div>
</div>
<div class="section" id="grub">
<h3>2. GRUB</h3>
<p>Install GRUB to the <strong>Master Boot Record (MBR)</strong> of the USB device at MOUNTPOINT ...</p>
<div class="highlight"><pre><span></span>$ sudo grub-install --force --no-floppy --root-directory<span class="o">=</span>/media/MOUNTPOINT /dev/sdX
</pre></div>
</div>
<div class="section" id="linux-images">
<h3>3. Linux images</h3>
<p>Download and copy Linux ISO images to the newly-created <tt class="docutils literal">boot/iso</tt> folder on the USB device. I have installed ...</p>
<ul class="simple">
<li><strong>SystemRescueCd</strong> - <a class="reference external" href="http://www.system-rescue-cd.org/">Collection of Linux repair tools</a></li>
<li><strong>Debian Jessie Netinst+firmware</strong> - <a class="reference external" href="https://cdimage.debian.org/cdimage/unofficial/non-free/cd-including-firmware/8.7.1+nonfree/amd64/iso-cd/">64bit</a> and <a class="reference external" href="https://cdimage.debian.org/cdimage/unofficial/non-free/cd-including-firmware/8.7.1+nonfree/i386/iso-cd/">32bit</a> installers</li>
<li><strong>Ubuntu 16.04 LTS Mini-Installers</strong> - <a class="reference external" href="http://archive.ubuntu.com/ubuntu/dists/xenial/main/installer-amd64/current/images/netboot/">64bit mini.iso</a> and <a class="reference external" href="http://archive.ubuntu.com/ubuntu/dists/xenial/main/installer-i386/current/images/netboot/">32bit mini.iso</a></li>
</ul>
<div class="section" id="debian-netinst">
<h4>3.1 Debian Netinst</h4>
<p>Problem: This was a bit tricky to get working. Selecting <tt class="docutils literal"><span class="pre">firmware-8.7.1-ARCH-netinst.iso</span></tt> from the GRUB menu would get things started but the install would fail at the stage where the ISO needs to be located and mounted. Debian's netinst images do not include the <strong>iso-scan</strong> package , which is required for searching and loading ISO images.</p>
<p>Fix: Bypass the <tt class="docutils literal">initrd.gz</tt> that is on the ISO images and use ones that <em>do</em> contain the iso-scan package, which I retrieved from the <strong>hd-media</strong> installers ...</p>
<div class="highlight"><pre><span></span>$ mkdir /media/MOUNTPOINT/boot/debian/install.<span class="o">{</span>amd,386<span class="o">}</span>
$ <span class="nb">cd</span> /media/MOUNTPOINT/boot/debian/install.amd
$ wget http://ftp.debian.org/debian/dists/jessie/main/installer-amd64/current/images/hd-media/initrd.gz
$ <span class="nb">cd</span> .. /install.386
$ wget http://ftp.debian.org/debian/dists/jessie/main/installer-i386/current/images/hd-media/initrd.gz
</pre></div>
<p>Helpful resource in figuring this out! <a class="reference external" href="http://126kr.com/article/6xzqwchvlv6">Multi-boot stick update</a></p>
</div>
</div>
<div class="section" id="grub-configuration">
<h3>4. GRUB configuration</h3>
<p>Create <tt class="docutils literal">grub.cfg</tt> with entries for the Linux images copied to the USB device. Each distro is a little bit different in the manner its booted by GRUB. Example ...</p>
<div class="highlight"><pre><span></span><span class="c1"># Config for GNU GRand Unified Bootloader (GRUB)</span>
<span class="c1"># /boot/grub/grub.cfg</span>

<span class="c1"># Timeout for menu</span>
<span class="nb">set</span> <span class="nv">timeout</span><span class="o">=</span>30

<span class="c1"># Default boot entry</span>
<span class="nb">set</span> <span class="nv">default</span><span class="o">=</span>0

<span class="c1"># Menu Colours</span>
<span class="nb">set</span> <span class="nv">menu_color_normal</span><span class="o">=</span>white/black
<span class="nb">set</span> <span class="nv">menu_color_highlight</span><span class="o">=</span>white/green

<span class="c1"># Path to the partition holding ISO images (using UUID)</span>
<span class="c1">#set imgdevpath=&quot;/dev/disk/by-uuid/UUID_value&quot;</span>
<span class="c1"># ... or...</span>
<span class="c1"># Path to the partition holding ISO images (using device labels)</span>
<span class="c1">#set imgdevpath=&quot;/dev/disk/by-label/label_value&quot;</span>
<span class="nb">set</span> <span class="nv">imgdevpath</span><span class="o">=</span><span class="s2">&quot;/dev/disk/by-label/MULTIBOOT&quot;</span>

<span class="c1"># Boot ISOs</span>
menuentry <span class="s2">&quot;SystemRescueCd std-64bit&quot;</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">iso</span><span class="o">=</span><span class="s2">&quot;/iso/systemrescuecd-x86.iso&quot;</span>
    loopback loop <span class="nv">$iso</span>
    linux <span class="o">(</span>loop<span class="o">)</span>/isolinux/rescue64 <span class="nv">isoloop</span><span class="o">=</span><span class="nv">$iso</span>
    initrd <span class="o">(</span>loop<span class="o">)</span>/isolinux/initram.igz
<span class="o">}</span>

menuentry <span class="s2">&quot;SystemRescueCd std-32bit&quot;</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">iso</span><span class="o">=</span><span class="s2">&quot;/iso/systemrescuecd-x86.iso&quot;</span>
    loopback loop <span class="nv">$iso</span>
    linux <span class="o">(</span>loop<span class="o">)</span>/isolinux/rescue32 <span class="nv">isoloop</span><span class="o">=</span><span class="nv">$iso</span>
    initrd <span class="o">(</span>loop<span class="o">)</span>/isolinux/initram.igz
<span class="o">}</span>

menuentry <span class="s2">&quot;Debian Jessie - 64bit Netinst+firmware&quot;</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">iso</span><span class="o">=</span><span class="s2">&quot;/boot/iso/firmware-8.7.1-amd64-netinst.iso&quot;</span>
    loopback loop <span class="nv">$iso</span>
    linux <span class="o">(</span>loop<span class="o">)</span>/install.amd/vmlinuz iso-scan/ask_second_pass<span class="o">=</span><span class="nb">true</span> iso-scan/filename<span class="o">=</span><span class="nv">$iso</span> <span class="nv">priority</span><span class="o">=</span>low <span class="nv">vga</span><span class="o">=</span><span class="m">788</span> --- quiet
    initrd /boot/debian/install.amd/initrd.gz
<span class="o">}</span>

menuentry <span class="s2">&quot;Debian Jessie - 32bit Netinst+firmware&quot;</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">iso</span><span class="o">=</span><span class="s2">&quot;/boot/iso/firmware-8.7.1-i386-netinst.iso&quot;</span>
    loopback loop <span class="nv">$iso</span>
    linux <span class="o">(</span>loop<span class="o">)</span>/install.386/vmlinuz iso-scan/ask_second_pass<span class="o">=</span><span class="nb">true</span> iso-scan/filename<span class="o">=</span><span class="nv">$iso</span> <span class="nv">priority</span><span class="o">=</span>low <span class="nv">vga</span><span class="o">=</span><span class="m">788</span> --- quiet
    initrd /boot/debian/install.386/initrd.gz
<span class="o">}</span>

menuentry <span class="s2">&quot;Ubuntu 16.04 LTS - 64bit Mini-Installer&quot;</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">iso</span><span class="o">=</span><span class="s2">&quot;/iso/ubuntu-lts-amd64-mini.iso&quot;</span>
    loopback loop <span class="nv">$iso</span>
    linux <span class="o">(</span>loop<span class="o">)</span>/linux <span class="nv">boot</span><span class="o">=</span>casper iso-scan/filename<span class="o">=</span><span class="nv">$iso</span> noprompt noeject
    initrd <span class="o">(</span>loop<span class="o">)</span>/initrd.gz
<span class="o">}</span>

menuentry <span class="s2">&quot;Ubuntu 16.04 LTS - 32bit Mini-Installer&quot;</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">iso</span><span class="o">=</span><span class="s2">&quot;/iso/ubuntu-lts-i386-mini.iso&quot;</span>
    loopback loop <span class="nv">$iso</span>
    linux <span class="o">(</span>loop<span class="o">)</span>/linux <span class="nv">boot</span><span class="o">=</span>casper iso-scan/filename<span class="o">=</span><span class="nv">$iso</span> noprompt noeject
    initrd <span class="o">(</span>loop<span class="o">)</span>/initrd.gz
<span class="o">}</span>

menuentry <span class="s2">&quot;Ubuntu 16.04 LTS - 32bit Installer (&#39;forcepae&#39; for Pentium M)&quot;</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">iso</span><span class="o">=</span><span class="s2">&quot;/iso/ubuntu-lts-i386-mini.iso&quot;</span>
    loopback loop <span class="nv">$iso</span>
    linux <span class="o">(</span>loop<span class="o">)</span>/linux <span class="nv">boot</span><span class="o">=</span>casper iso-scan/filename<span class="o">=</span><span class="nv">$iso</span> noprompt noeject forcepae
    initrd <span class="o">(</span>loop<span class="o">)</span>/initrd.gz
<span class="o">}</span>
</pre></div>
<p>Save <tt class="docutils literal">grub.cfg</tt> to the USB stick at <tt class="docutils literal">boot/grub</tt>.</p>
<p>All done! Reboot, configure USB (set in BIOS) as boot device, save changes, reboot again, and GRUB will display the menu of Linux distro images. Remove the USB multi-boot device, reboot, and return to using your USB device as removable storage.</p>
</div>
<div class="section" id="grubs-reanimated-usb-boot-stick">
<h3>5. GRUBS Reanimated USB Boot Stick</h3>
<p>I created the <a class="reference external" href="https://github.com/vonbrownie/grubs">GRUBS shell script</a> that creates multi-boot Linux USB sticks using the above steps and placed it on GitHub.</p>
<p>Happy hacking!</p>
</div>
</div>

    <p class="articletags"><i class="fa fa-coffee"></i> More         &#8226; <a class="tag" href="http://www.circuidipity.com/tag-grub.html">grub</a>
        &#8226; <a class="tag" href="http://www.circuidipity.com/tag-shell.html">shell</a>
        &#8226; <a class="tag" href="http://www.circuidipity.com/tag-systemrescuecd.html">systemrescuecd</a>
        &#8226; <a class="tag" href="http://www.circuidipity.com/tag-debian.html">debian</a>
        &#8226; <a class="tag" href="http://www.circuidipity.com/tag-ubuntu.html">ubuntu</a>
        &#8226; <a class="tag" href="http://www.circuidipity.com/tag-linux.html">linux</a>
</p>
</div>

<!-- Nav links to previous|next article -->
<div id="navmenu">
    <hr />
    <p class="prevpost"><i class="fa fa-arrow-left"></i> Older<br />
        <a href="http://www.circuidipity.com/great-fun-getting-started-with-jekyll.html">Great fun getting started with Jekyll</a></p>
    <p class="nextpost">Newer <i class="fa fa-arrow-right"></i><br />
        <a href="http://www.circuidipity.com/virtualbox-install.html">Virtualbox</a></p>
</div>


        <!-- footer -->
<div id="footer">
    <img class="imgfooter" src="./theme/images/footerbar.png" />
    <p class="contentinfo">
    <span class="noWrap">
        Copyright &#169; 2017 and
        <a rel="license" class="ccLicense" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA License</a> by
        <a rel="author" class="authorID" href="/">Daniel Wayne Armstrong</a>
    </span>
    <span class="noWrap">
        <i class="fa fa-globe"></i>
        Find me at <span class="whoa">daniel at circuidipity dot com</span>
    </span>
    <br />
    Don't miss a thing... updates by
    <a href="feed.xml">RSS</a> and
    <a class="subTweat" href="https://twitter.com/circuidipity">Twitter</a>
    </p>
</div></body>
</html>